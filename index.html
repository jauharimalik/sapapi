<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM2 Service Monitor</title>
</head>
<body>
    <h1>PM2 Service Status</h1>
    <div id="services-container">Loading...</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('services-container');
    
    // URL ini mengambil data dari repository "sapapi"
    const statusFileUrl = 'https://jauharimalik.github.io/sapapi/pm2-status.json';

    fetch(statusFileUrl)
        .then(response => {
            if (!response.ok) {
                // Periksa status respons HTTP.
                if (response.status === 404) {
                    throw new Error('File pm2-status.json not found. Check GitHub Pages settings for sapapi repository.');
                }
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            container.innerHTML = '';
            if (data.length === 0) {
                container.innerHTML = '<p>No PM2 services are running.</p>';
                return;
            }

            data.forEach(service => {
                const serviceDiv = document.createElement('div');
                const status = service.pm2_env.status;
                
                serviceDiv.innerHTML = `
                    <h3>${service.name}</h3>
                    <p>Status: ${status}</p>
                    <p>ID: ${service.pm_id}</p>
                    <p>CPU: ${service.monit.cpu}%</p>
                    <p>Memory: ${(service.monit.memory / 1024 / 1024).toFixed(2)} MB</p>
                `;
                container.appendChild(serviceDiv);
            });
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            container.innerHTML = `<p>${error.message}</p>`;
        });
});
</script>
</body>
</html>